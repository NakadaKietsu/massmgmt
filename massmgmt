#!/bin/bash
# -----------------------------------------------------------------------------
#                                massmgmt
#                 launchd-based macOS desired-state management
#                           Last Edited: 6/13/17
# -----------------------------------------------------------------------------
# define admin user
adminUser="$(dscl . list /Users UniqueID | awk '$2 == 501 {print $1}')"

# log file location
logFile="/Users/$adminUser/Library/Logs/massmgmt/massmgmtLog.txt"
starDate="$(date)"
hostName="$(hostname)"

# define location of help page
helpPage="/usr/local/massmgmt/help.txt"

# define log location
logDir="/Users/$adminUser/Library/Logs/massmgmt"

# define bin location for scripts
binLoc="/usr/local/massmgmt/bin"

# add phone home for text data of status or log aggregation in later versions

# ----------list functions and packaged scripts that massmgmt can call---------
#/usr/local/massmgmt/bin/autoUpdate
#/usr/local/massmgmt/bin/chrome
#/usr/local/massmgmt/bin/enableARD
#/usr/local/massmgmt/bin/enableSSH
#/usr/local/massmgmt/bin/setHostname
#/usr/local/massmgmt/bin/setTimezone
# -----------------------------------------------------------------------------
if [ "$1" == "flushLogs" ] ; then
    printf "Are you sure you want to flush the log directory? (y/n) -> "
    read A
    if [ "$A" == "n" ] ; then
        exit
    elif [ "$A" == "y" ] ; then
        echo "Removing $logDir"
        rm -rf "$logDir"
        mkdir "$logDir"
        echo "Logs flushed"
        exit
    else
        echo "Invalid option"
        exit
    fi
else
    echo >> "$logFile"
    echo "$starDate -- $hostName ----" >> "$logFile"
    echo >> "$logFile"
    # run autoUpdate script
    echo "$starDate --- Running autoUpdate" >> "$logFile"
    $binLoc/autoUpdate
    # run chrome update script
    echo "$starDate --- Running chrome" >> "$logFile"
    $binLoc/chrome
    # run enableARD script
    echo "$starDate --- Running enableARD" >> "$logFile"
    $binLoc/enableARD
    # run enableSSH script
    echo "$starDate --- Running enableARD" >> "$logFile"
    $binLoc/enableSSH
    # run setHostname script
    echo "$starDate --- Running setHostname" >> "$logFile"
    $binLoc/setHostname
    # run setTimezone script
    echo "$starDate --- Running setTimezone" >> "$logFile"
    $binLoc/setTimezone
    # close out log
    echo >> "$logFile"
    echo "$starDate --- Exiting" >> "$logFile"
    echo >> "$logFile"
    echo "$starDate -- $hostName ----" >> "$logFile"
fi
exit
# -----------------------------------------------------------------------------
